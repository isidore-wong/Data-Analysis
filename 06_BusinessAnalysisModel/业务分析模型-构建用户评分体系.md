## 用户评分体系的构建

### 1.背景
在互联网时代，一次的活动可能会带来流量，尤其是电商运营、活动促销等带来的流量更为明显，但这其中有个存在一个一直难以解决的问题--用户中存在大量羊毛党，真正获取到的客户确实屈指可数的。

#### 1.1 用户精细化运营的方法
在做活动、营销等运营动作之前，运用AHP和RFM分析方法构建用户评分体系，衡量用户的价值，进而采用有效的精细化运营方案。

---

### 2. AHP制定权重
#### 2.1 AHP是什么？
层次分析法（Analytic Hierarchy Process）简称AHP，指将与决策有关的因素分解成目标、准则、方法等层次，主要用于将定性的问题进行定量化分析决策。

例如：某电商平台根据用户行为数据对用户构建综合评分模型，将用户分为忠诚用户、活跃用户、沉默用户等，进而在业务运营中进行精细化的运营。

#### 2.2 AHP的基本原理
层次分析法是一种解决多目标的复杂问题的**定性与定量相结合**的决策分析方法。将决策者的主观判断与推理密切结合起来，也就是对决策者的推理或者判断过程进行量化，从而避免决策者在结构复杂或方案较多时逻辑推理失误。

通过决策者的经验判断各衡量目标之间能否实现的标准之间的相对重要程度，并合理地给出每个决策方案的每个标准的权数，利用权数求出各方案的优劣次序，比较有效地应用于那些难以用定量方法解决的课题。


**层次分析法的分析步骤如下**

![AHP原理](https://note.youdao.com/yws/api/personal/file/WEB7abd2c771a3f69b1a25a5fdaf949b965?method=download&shareKey=3108a770cd2b1ad06364a5233632704c)

**1）建立评分体系**

构建用户价值评分体系，对各类用户进行精细化运营。

设定目标，列出影响目标的所有元素。采用专家打分、用户问卷等方式，逐一列出所有的影响因素，比如活跃度、忠诚度、购买力等。

**2）构建层次结构、判断矩阵**

列出影响因素的指标或方案。
- 判断影响用户活跃度的指标有浏览页面次数、停留时长、浏览商品次数、下单次数。
- 判断影响用户忠诚度的指标有最近访问时间、访问频率、主动评价次数。
- 判断影响用户购买力的指标有单笔最高金额、平均订单金额、购买次数。

**3）算出权重系数**
分别算出各个指标层、准则层的指标权重，然后再计算决策公式，如图：
![层次结构](https://note.youdao.com/yws/api/personal/file/WEB87d3b20e57c15210a0c1137c97d62107?method=download&shareKey=ea7c9ac52e57a38ccb3a6cf6daf183ff)

**4）一致性校验**

若一致性指标 CR<0.1，就进入下一环节；否则，对各指标权重重新赋值（即，重新构建判断矩阵）

**5）层次排序**

层次排序分为层次单排序和层次总排序。所谓层次单排序，指对于上一层某因素而言，本层次各因素的重要性的排序；所谓层次总排序，指确定某层所有因素总目标相对重要性的排序权值过程。

层次排序是从最高层到最底层依次进行的。对于最高层次而言，其层次单排序的结果也是总排序的结果。

#### 2.3 确定权重
**1）构造判断矩阵**

在确定各层次因素的重要程度时，如果仅从定性的角度考虑，结果不具备说服力，因此需要从定量的角度确定，即采用**一致性矩阵法**--将所有因素两两进行比较并打分，从而确定合适的标度。

建立层次结构后，比较因子及其下属指标的各个比重，实现定性向定量转化；比如采用1-9分的标度法，构建决策层的打分矩阵A，如下图：

![决策矩阵](https://note.youdao.com/yws/api/personal/file/WEBa04fc14b5a788d1e51221286691354f1?method=download&shareKey=851d9669b65f05146c242594f5bd3609)

上面打分矩阵为3*3的方阵，记为A，对应的元素为
```math
a_{ij}  
```
这个方阵的特点如下：
- a_ij的意思是，与指标j相比，i的重要程度
- 当i = j时，同一个因素相比，记为1，对角线的元素均为1
- a_ij > 0且a_ij * a_ji = 1，通常称满足这一条件的矩阵为正互反矩阵

上述的打分矩阵即为层次分析中的判断矩阵。


#### 2.4 一致性校验
一致性检验是为了检验各因素重要程度之间的协调性，避免出现A比B重要，B比C重要，C又比A重要这种矛盾情况。

**相关理论：**

一致性矩阵：![一致性矩阵](https://note.youdao.com/yws/api/personal/file/WEB89e649f45bd7556cfd646e6592bb2ee2?method=download&shareKey=e710f4fae696268c5726937d207ac974)

判断矩阵是否为一致性矩阵：n阶正互反矩阵A为一致性矩阵的充要条件是，A的最大特征值
```math
\lambda_{max} = n
```
在判断矩阵的构造中，并不要求判断矩阵一定要具备一致性，这是由客观事务的复杂性和主观认识的多样性决定的，但判断矩阵是计算排序权向量的依据，因此要求判断矩阵应该满足大体上的一致性。
![一致性指标](https://note.youdao.com/yws/api/personal/file/WEB828a8879be11f82dd5a2f1e88e7a7278?method=download&shareKey=5fe581ccf5b66e2c8716d43d54ed6ee0)

![RI表格](https://note.youdao.com/yws/api/personal/file/WEB3956b2709547102c369401e27876458d?method=download&shareKey=55c3d74bf57796affb15bb985983a186)

==***算法步骤***==
- 建立递阶层次结构模型
- 构造出各层次中的所有判断矩阵
- 层次单排序及一致性检验
- 层次总排序及一致性检验

*备注：整套算法实际上是用了两次重要性权重*
~~~~
1、准则层，从准则的重要性矩阵（nxn矩阵）中，抽取重要性权重。它的现实意义是每个准则的重要程度----也就是说，输入的是nxn一个矩阵，值是每个准则两两之间重要度，输出的是这n个准则各自的权重

2、方案层，对每个准则，m个方案都有个mxm矩阵（总共是n个mxm矩阵）。也就是说，对每个准则，都可以算出m个方案的重要性权重。----然后n个重要性权重组合起来，与准则层的重要性权重相乘。就得到了每个方案的重要性权重。
~~~~


**一致性检验计算步骤**

==1.计算准则层权重==

==1. 先求解特征向量==，这里采用手工计算法--和积法
![求解特征向量](https://note.youdao.com/yws/api/personal/file/WEB66b71ddc3d5c06625516103d3a3bf947?method=download&shareKey=8f71fb2ca8532cb7ea7d4674f5cc5de4)

矩阵A的特征值：(这里的规范化采用的是归一法)
- 1.1 求特征向量
![特征向量](https://note.youdao.com/yws/api/personal/file/WEBe87b1022889de1bd6a73fe5d5829a5bf?method=getImage&version=30287&cstk=xr5cQYba)

- 1.2求最大特征值
- ![最大特征值](https://note.youdao.com/yws/api/personal/file/WEB9b3d1ce8dfe67784ec73b2d4e8f086c1?method=getImage&version=30289&cstk=xr5cQYba)

==2.一致性检验==
![一致性检验](https://note.youdao.com/yws/api/personal/file/WEB8d4f6c197e9d1064d65831e800d71759?method=getImage&version=30288&cstk=xr5cQYba)

![决策层对目标层的权重](https://note.youdao.com/yws/api/personal/file/WEB15375deba05c57701fef95ac31a0b2c3?method=getImage&version=30290&cstk=xr5cQYba)

==2.计算指标层权重==

2.1计算活跃度的指标权重
![活跃度的指标权重](https://note.youdao.com/yws/api/personal/file/WEB9a3dbe594cfbd49d6c870c686d5277b2?method=getImage&version=30284&cstk=xr5cQYba)

故准则层相对活跃度的权重依次为：
- 浏览页面次数的权重：b1=0.63231
- 停留时长的权重：b2=0.21452
- 浏览商品次数的权重：b3=0.10961
- 下单次数的权重：b4=0.04357


2.2 计算忠诚度的指标权重
![忠诚度的指标权重](https://note.youdao.com/yws/api/personal/file/WEBd3d57176a140d7fd28dad4ec259387c2?method=getImage&version=30285&cstk=xr5cQYba)

故准则层相对忠诚度的权重依次为：
- 最近访问时间的权重：c1=0.61935
- 访问频率的权重：c2=0.28423
- 主动评价次数的权重：c3=0.09642


2.3 计算购买力的指标权重
![购买力的指标权重](https://note.youdao.com/yws/api/personal/file/WEB680faa4731ab4d87f47581ed055f0de5?method=getImage&version=30286&cstk=xr5cQYba)

故准则层相对购买力的权重依次为：
- 单笔最高金额的权重：d1=0.70706
- 平均订单金额的权重：d2=0.20141
- 购买次数的权重：d3=0.09153

==**全部的指标权重为：**==
![全部指标权重](https://note.youdao.com/yws/api/personal/file/WEBd59103d7d29a613ba85764548fc3ba99?method=getImage&version=30281&cstk=xr5cQYba)

#### 如果一致性校验没有通过，怎么办？
在实际构建评分矩阵时，会发生一致性校验不通过（如 CR>=0.1），这可能由于一些主观因素导致，也可能是由于构建模型不合理导致。所以需要重新构建打分矩阵，甚至需要重新构建层次分析模型。

==- 构建模型影响：==

因素是否合理、含义是否清晰、要素间是否重叠，这都会有影响。建议每层要素尽量不超过7个；如果元素之间的强度相差很大，尽量不要放在同一个层级。

==- 计算精度影响：==

特征值求解方法的不同（比如和积法、方根法等）、Excel 计算值的误差、计算工具的误差等，都可能导致一致性校验结果有些偏差，尽量使用计算精度更高的工具。

==**3、结论**==

运用 AHP 模型得出和公式：
- 活跃度=b1*浏览页面次数+b2*停留时长+b3*浏览商品次数+b4*下单次数
- 忠诚度=c1*最近访问时间+c2*访问频率+c3*主动评价次数；
- 购买力=d1*单笔最高金额+d2*平均订单金额+d3*购买次数；

==用户价值评分=0.64339*活跃度+0.28284*忠诚度+0.07377*购买力==

AHP方法使用较少的定量数据，就可以构建模型，最终的结论只能表明因素的重要程度，不能得出用户价值的评分值是多少，故需要结合RFM模型，算出各个因素的分值，得出每个用户的评分


### 3、RFM模型
RFM 模型通过分析客户的近期购买行为（Recency）、购买的总体频率（Frequency）以及消费金额（Monetary），来衡量客户价值及创造利润能力，为客户价值分析、流失预警分析等精细化运营提供依据。
- R：Regency（近度），即客户最近一次交易与当前时间的间隔
- F：Requency（频度），即客户的交易频率
- M：Montary（额度），即客户的交易金额

该模型的输入数据为：最近一次交易时间、交易频率、交易金额这三个核心指标，分别计算出每个指标数据的均值，分别以avg（R）、avg（F）、avg（M）表示，然后将每位客户的三个指标值分别与平均值进行对比，K-means聚类分析，可得出以下8类客户价值群体：
![RFM](https://note.youdao.com/yws/api/personal/file/WEB7a35f474ff7ed6ed981e8613fd9beba5?method=getImage&version=30482&cstk=xr5cQYba)

- **重要价值客户**：最近交易时间近、交易频率和交易金额高，肯定是优质客户。
- **重要发展客户**：最近交易时间近，交易金额高，但交易次数少，但不太活跃，忠诚度不高，需要重点识别。
- **重要保持客户**：交易金额和交易频次都很高，但最近一次交易时间远，是个很长时间没来的忠实客户，需要主动和客户来次互动，及时唤回。
- **重要挽留客户**：交易金额高，但最近交易时间远、交易频次低，是潜在的价值客户，需要重点挽留。
- **一般价值客户**：最近交易时间近、交易频次也高，唯独交易金额小，“屌丝”群体，客户价值需要挖掘。
- **一般发展客户**：最近交易时间近，但交易频次和交易金额小，有推广价值。
- **一般保持客户**：交易次数多，但是贡献不大，一般维持即可。
- **一般挽留客户**：最近交易时间远、交易频次和交易金额也都很小，贡献度最小，如果运营精力充沛也可挽留。


在使用RFM模型得到归一化的RFM处理数据后，结合AHP模型得到的活跃度/忠诚度/购买力的权重，计算得到每个用户的价值。

**参考教程**
1. [层次分析法-MBA智库](https://wiki.mbalib.com/wiki/AHP)
2. [电商用户体系](http://www.woshipm.com/pd/4385310.html)